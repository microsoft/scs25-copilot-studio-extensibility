# Lab 02 - Build an agent with Copilot Studio

In this lab, you will go through the following tasks:

- Add Dataverse as a knowledge source
- Add a website as a knowledge source
- Use adaptive cards to make your agent look nicer
- Enrich your agent with AI Prompts

## 📊 Add Dataverse as a knowledge source - Dataverse entity suppliers / data excel file (Mats)

## 🌐 Add a website as a knowledge source - Microsoft Learn (Mats)

## 🎨 Use adaptive cards to make your agent look nicer

Now lets make sure the users of our agent can ask for content - and lets use a different option here. Instead of using knowledge, we will create a topic with an adaptive card. The adaptive card will be used to make sure not only text is shown, but also a bit of design is shown.

## ✨ Enrich your agent with AI Prompts

There is a lot of content available in our agent now, but we haven't shown one of the hidden gems of Copilot Studio yet: AI Prompts!

Tools can be used to extend the capabilities of agents. You can add multiple types of tools to your agents in Microsoft Copilot Studio:

- **Prebuilt connector action**, which use Power Platform connectors to access data from other systems, such as popular enterprise products like Salesforce, Zendesk, MailChimp, and GitHub.
- **Custom connector action**, where a connector can be built to access data from public or private APIs.
- **Power Automate cloud flow**, which use Power Automate cloud flows to perform actions, retrieve and work with data.
- **AI Builder prompts**, which use AI Builder and natural language understanding to target the specific scenarios and workflows within your business.
- **Bot Framework skill**, which use the skill manifest that outlines the actions the skill can perform, including its input and output parameters, the skill's endpoints, and dispatch models for the skill.

### Add an AI prompt to a topic

In this part of the lab we’ll be creating a **AI prompt** in a topic.

Prompt tools in topics help guide the agent's response in a semi-scripted conversation by using the generative AI models from AI Builder and natural language understanding to address specific scenarios for your agents.

For this lab, we'll add a Topic that calls a prompt action to generate questions for a quiz.

1. In your agent select the **Topics** tab, select **+ Add a topic** and select **From blank**.

    ![Add topic from blank](./assets/Lab2_4_1_01_AddTopicFromBlank.png)

1. Enter a **name** for the Topic such as `Generate questions for a quiz` and enter the text below under **Describe what the topic does**

    ```text
    This topic covers creating interactive quizzes based on a chosen subject. It generates a set number of questions and formats them according to given instructions. The goal is to produce well-structured, engaging quizzes that match the topic and layout preferences.
    ```  

    ![Add topic description](./assets/Lab2_4_1_02_TopicDescription.png)

1. Select **Save** on the top right of the authoring canvas to save the Topic.

    ![Save topic](./assets/Lab2_4_1_03_SaveTopic.png)

1. Under the trigger node, select the **+** icon and select the **Call an action** node, followed by selecting **Create a prompt**.

    ![Call an action node](./assets/Lab2_4_1_04_CallAnActionNode.jpg)

1. The Prompt dialog will appear, and you may see a flyout appear that will guide you on how to create your prompt. Select **Next** to go through the guide.

    ![Guide](./assets/Lab2_4_1_05_Guide.jpg)

1. Let's take a moment to familiarize ourselves with the Prompt dialg. You’ll see the following:
    - **Name** of the prompt on the top left
    - **Prompt settings** on the right hand side which contains
        - **Input** where the inputs parameters for the prompt can be added or deleted.
        - **Data used (preview**) where you can use your own data from Dataverse tables in a prompt.
        - **Output** where you define the response to be returned as text or JSON (preview).
        - **Settings** where you define the GPT model to be used for generating responses and the temperature slider allows you to select the temperature to control the randomness of the output generated by the AI model, [learn more](https://learn.microsoft.com/ai-builder/prompt-modelsettings).
    - **Prompt** on the top left hand side which is where you can enter your prompt. You can also start by using the suggested prompts, and test the prompt.
    - **Prompt response** on the bottom left hand side which displays the response generated based on the prompt.

    ![Prompt dialog](./assets/Lab2_4_1_06_PromptDialog.jpg)

1. We'll create prompt that will generate questions for a quiz. Enter a name for the prompt such as `Quiz Generator`

    ![Prompt name](./assets/Lab2_4_1_07_PromptName.jpg)

1. Instead of creating a custom prompt from scratch or using a template, a prompt from the [**Power Platform Prompt Samples**](https://aka.ms/power-prompts) library can be used. In a new browser tab, navigate to [https://aka.ms/power-prompts](https://aka.ms/power-prompts) and filter to _AI Builder_ by ticking the checkbox on the left hand side.

    ![Filter](./assets/Lab2_4_1_08_FilterSampleSolutionGallery.jpg)

1. Select the [Quiz Generator Prompt](https://adoption.microsoft.com/sample-solution-gallery/sample/pnp-powerplatform-prompts-quiz-generator/). This prompt will generate a quiz based on three input parameters,
    - number which is the number of questions
    - topic which is the topic of the quiz
    - format which is the output format of the questions

    **Copy** the Quiz Generator prompt.

    ![Quiz Generator prompt](./assets/Lab2_4_1_09_QuizGeneratorPrompt.jpg)

1. Go back to the action in Copilot Studio. **Paste** the copied prompt value in the Prompt box on the top left hand side.

    ![Paste Prompt](./assets/Lab2_4_1_10_PastePrompt.jpg)

1. Expand the **Input** section and select **+ Add input**.

    ![Add input](./assets/Lab2_4_1_11_AddInput.jpg)

1. Enter a name for the first input of `number` and enter sample data such as `5`

    ![Add number input](./assets/Lab2_4_1_12_AddNumberInput.jpg)

1. Repeat the same for the second and third input of topic and format. Make sure you provide sample data.

    ![Input parameters](./assets/Lab2_4_1_13_InputParameters.jpg)

1. Next, the inputs needs to be inserted into the prompt. In the Prompt, highlight **[number]** and select **+ Insert** and select **number**. The input of _number_ has now been added to the prompt as an input. Repeat the same steps for the remaining inputs.

    ![Insert inputs](./assets/Lab2_4_1_14_PromptInputParameters.jpg)

1. Test the prompt before saving the custom prompt. Select **Test prompt** and a response to the prompt regarding the values provided in the sample data of the input is returned. You can also **maximize** the prompt response box to enlarge the prompt response dialog.

    ![Test Prompt response](./assets/Lab2_4_1_15_TestPromptResponse.jpg)

1. Since we're not covering Dataverse in this workshop, the **Data used (preview)** does not need to be updated in the **Prompt settings**. The **Output** can be left as the default which is Text, and the **Settings** can be left as the default.

    Let's now save the prompt by selecting **Save custom prompt**

    ![Save custom prompt](./assets/Lab2_4_1_16_SaveCustomPrompt.jpg)

1. The prompt action node will now appear in the authoring canvas of the Topic. Next, the values of the input parameter need to be defined in order for the agent to populate them. This value can be
    - a literal value
    - an existing variable (custom, system or environment)
    - a Power Fx formula that could also reference existing variables

    Select the **>** icon

    ![Input variable value](./assets/Lab2_4_1_17_InputParameterValue.jpg)

1. Select the **System** tab and select the **Acivity.Text** as the input value for the action to use the user’s entire response and identify the format value.

    ![Input Parameter Value Selected](./assets/Lab2_4_1_18_SelectInputParameterValue.jpg)

1. Repeat the same for the remaining input parameters of the prompt action.

    ![Input Parameter Values selected](./assets/Lab2_4_1_19_InputParameterValueSelected.jpg)

1. Next, we need to define the output variable of the prompt action. This is so that the response can be referenced downstream in the topic. Select the **>** icon and in the **Custom** tab, select **Create new**

    ![Create new output variable](./assets/Lab2_4_1_20_CreateActionOutputVariable.jpg)

1. A new variable named `Var1` appears as the variable output. Select the variable and the variable properties pane will appear. Enter a variable name such as `VarQuizQuestionsResponse`

    ![Prompt action variable output](./assets/Lab2_4_1_21_VariableOutput.jpg)

1. Below the Prompt action, select the **+** icon to add a new node and select **Send a message**. Select the **{x}** variable icon.

    ![Send a message node](./assets/Lab2_4_1_22_SendMessage.jpg)

1. Select the variable **VarQuizQuestionsResponse.text**. This will add the text property of the prompt action response to the send a message node.

    ![Select variable output](./assets/Lab2_4_1_23_VarQuizQuestionsResponse.text.jpg)

1. Select **Save** to save your topic.

1. The Topic details needs to be updated next which will be used by your agent to associate the topic with the user's intent when [Generative mode](https://learn.microsoft.com/microsoft-copilot-studio/advanced-generative-actions#how-does-generative-mode-work) is enabled. Select **Details** and for the **Display name** enter the following

    ```text
    generate questions for a quiz
    ```

    For the **Description** enter the following

    ```text
    This topic creates questions for a quiz based on the number of questions, the topic and format provided by the user
    ```

    ![Update Topic details](./assets/Lab2_4_1_24_UpdateTopicDetails.jpg)

1. Select **Save** to save your topic.

1. Lastly, the [Generative mode](https://learn.microsoft.com/microsoft-copilot-studio/advanced-generative-actions#how-does-generative-mode-work) setting needs to be enabled for the agent to call the topic with the prompt action. Select **Settings** for your agent.

    ![Agent settings](./assets/Lab2_4_1_25_Settings.jpg)

1. Select the **Generative AI** setting and select **Generate (preview)** followed by selecting **Save**.

    ![Enable Generative mode](./assets/Lab2_4_1_26_EnableGenerativeMode.jpg)

1. Great, we're now ready to test the agent. In the test pane, select the **refresh** icon. Then enter the following question,

    ```text
    Create 5 questions for a quiz based on geography and format the quiz as multi choice
    ```

    ![Test prompt action](./assets/Lab2_4_1_27_TestPromptAction.jpg)

1. A response is returned where 5 questions have been provided with the answers on the topic of geography and is formatted as multi choice questions.

    ![Test prompt action response](./assets/Lab2_4_1_28_TestPromptActionResponse.jpg)
